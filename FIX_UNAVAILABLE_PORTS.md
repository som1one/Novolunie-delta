# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ü–æ—Ä—Ç—ã 80 –∏ 443 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

## –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
cd ~/novolunie
git pull origin main
chmod +x diagnose-ports.sh
./diagnose-ports.sh
```

## –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ø–æ—à–∞–≥–æ–≤–æ)

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```bash
cd ~/novolunie
docker compose ps
```

–ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω:
```bash
docker compose up -d
docker compose ps
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–ª—É—à–∞—é—Ç—Å—è –ª–∏ –ø–æ—Ä—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 80
sudo netstat -tlnp | grep ":80 "

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 443
sudo netstat -tlnp | grep ":443 "
```

–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –Ω–µ —Å–ª—É—à–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker compose logs web
```

### –®–∞–≥ 3: –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ (UFW)

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å UFW
sudo ufw status

# –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞
sudo ufw status numbered
```

### –®–∞–≥ 4: –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ iptables (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

```bash
sudo iptables -I INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -I INPUT -p tcp --dport 443 -j ACCEPT
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

### –®–∞–≥ 5: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π Nginx (–µ—Å–ª–∏ –º–µ—à–∞–µ—Ç)

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π Nginx
sudo systemctl status nginx

# –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ
sudo systemctl stop nginx
sudo systemctl disable nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
cd ~/novolunie
docker compose restart
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `docker-compose.yml` –ø–æ—Ä—Ç—ã –ø—Ä–æ–±—Ä–æ—à–µ–Ω—ã:

```yaml
ports:
  - "80:80"
  - "443:443"
```

–ï—Å–ª–∏ –Ω–µ—Ç, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker compose down
docker compose up -d
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# HTTP
curl -I http://localhost
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/1.1 301 Moved Permanently

# HTTPS
curl -I https://localhost
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/2 200
```

## –ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –≤—Å—ë –µ—â—ë –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã —Å–Ω–∞—Ä—É–∂–∏

### –§–∞–π—Ä–≤–æ–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

–ú–Ω–æ–≥–∏–µ —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–º–µ—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π—Ä–≤–æ–ª –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. **–≠—Ç–æ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞!**

#### Timeweb:
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **–°–µ—Ä–≤–µ—Ä ‚Üí –§–∞–π—Ä–≤–æ–ª**
3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞:
   - –ü–æ—Ä—Ç 80 (TCP) - —Ä–∞–∑—Ä–µ—à–∏—Ç—å
   - –ü–æ—Ä—Ç 443 (TCP) - —Ä–∞–∑—Ä–µ—à–∏—Ç—å
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### Selectel:
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **–°–µ—Ç—å ‚Üí –§–∞–π—Ä–≤–æ–ª**
3. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 80 –∏ 443
4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É

#### DigitalOcean:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Networking ‚Üí Firewalls**
2. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
3. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞:
   - Inbound: TCP, Port 80, Allow
   - Inbound: TCP, Port 443, Allow
4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É

#### AWS (EC2):
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **EC2 ‚Üí Security Groups**
2. –í—ã–±–µ—Ä–∏—Ç–µ Security Group –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
3. –î–æ–±–∞–≤—å—Ç–µ Inbound Rules:
   - Type: Custom TCP, Port: 80, Source: 0.0.0.0/0
   - Type: Custom TCP, Port: 443, Source: 0.0.0.0/0

#### Google Cloud:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **VPC Network ‚Üí Firewall rules**
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 80 –∏ 443
3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É

#### Azure:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Network Security Groups**
2. –î–æ–±–∞–≤—å—Ç–µ Inbound rules –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 80 –∏ 443

### –ì—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –æ–±–ª–∞–∫–µ

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤ –æ–±–ª–∞–∫–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Security Groups / Firewall rules:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–µ—à–∞—é—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø–æ—Ä—Ç—ã 80 –∏ 443
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Source (–∏—Å—Ç–æ—á–Ω–∏–∫) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `0.0.0.0/0` –∏–ª–∏ –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

## –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
cd ~/novolunie
chmod +x diagnose-ports.sh
./diagnose-ports.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –ü—Ä–æ–±—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã
- ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
- ‚úÖ –§–∞–π—Ä–≤–æ–ª (UFW, iptables)
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–π Nginx
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Docker
- ‚úÖ Nginx –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Å–Ω–∞—Ä—É–∂–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –° —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# HTTP
curl -I http://localhost
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/1.1 301 Moved Permanently

# HTTPS
curl -I https://localhost
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/2 200
```

### –°–Ω–∞—Ä—É–∂–∏ (—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞):

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ IP –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
curl -I http://85.239.44.197
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/1.1 301 Moved Permanently

curl -I https://e-novolunie.ru
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: HTTP/2 200
```

### –° –ø–æ–º–æ—â—å—é telnet/nc:

```bash
# –° –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
telnet 85.239.44.197 80
# –ò–ª–∏
nc -zv 85.239.44.197 80

telnet 85.239.44.197 443
# –ò–ª–∏
nc -zv 85.239.44.197 443
```

–ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã. –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd ~/novolunie
docker compose up -d
docker compose logs web
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º Nginx

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo systemctl stop nginx
sudo systemctl disable nginx
docker compose restart
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –§–∞–π—Ä–≤–æ–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∏–Ω–≥-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (—Å–º. –≤—ã—à–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose exec web nginx -t
# –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ nginx.conf
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd ~/novolunie
chmod +x copy-ssl-certificates.sh
./copy-ssl-certificates.sh
```

## –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω—ë—Ç —Å–µ—Ä–≤–µ—Ä –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Ä—Ç–æ–≤. –û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º –Ω–∞–≥—Ä—É–∑–∫–∏.
