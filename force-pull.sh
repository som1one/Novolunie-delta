#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –∏–∑ Git (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ç–∫–∏)

echo "üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∏–∑ Git"
echo "====================================="
echo ""

cd ~/novolunie || exit 1

echo "1Ô∏è‚É£ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
BACKUP_DIR="/tmp/novolunie-backup-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"
cp -r . "$BACKUP_DIR/" 2>/dev/null || true
echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: $BACKUP_DIR"

echo ""
echo "2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ Git..."
git fetch origin main

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ fetch –∏–∑ Git!"
    exit 1
fi

echo ""
echo "3Ô∏è‚É£ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ–π –≤–µ—Ç–∫–∏..."
git reset --hard origin/main

if [ $? -eq 0 ]; then
    echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∞!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ reset!"
    exit 1
fi

echo ""
echo "4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
git status

echo ""
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤..."
git log --oneline -5

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å Git"
echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:"
if [ -f "assets/logo.png" ]; then
    echo "‚úÖ –õ–æ–≥–æ—Ç–∏–ø –Ω–∞–π–¥–µ–Ω: assets/logo.png"
    ls -lh assets/logo.png
else
    echo "‚ö†Ô∏è  –õ–æ–≥–æ—Ç–∏–ø –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi
